test_that("tidy_iobed_stream works", {
  # setup
  ok_stream <- c(
    "2", "9", "6", " ", " ", " ", " ", "1", "9", "5", " ", " ",
     " ", "2", "2", "9", " ", " ", " ", " ", "2", "7", "7", " ", " ",
     " ", " ", "3", "8", " ", " ", " ", " ", " ", "1", "6", ":", "4",
     "2", ":", "3", "8", "\n", "\n", "", "2", "9", "6", " ", " ",
     " ", " ", "1", "9", "5", " ", " ", " ", "2", "2", "9", " ", " ",
     " ", " ", "2", "7", "7", " ", " ", " ", " ", "3", "8", " ", " ",
     " ", " ", " ", "1", "6", ":", "4", "2", ":", "3", "9", "\n",
     "\n", "", "2", "9", "6", " ", " ", " ", " ", "1", "9", "5"
  )

  ko_stream <- c(
    " ", " ", " ", " ", "1", "9", "5", " ", " ",
    " ", "2", "2", "9", " ", " ", " ", " ", "2", "7", "7", " ", " ",
    " ", " ", "3", "8", " ", " ", " ", " ", " ", "1", "6", ":", "4",
    "2", ":", "3", "8", "\n", "\n", "", "2", "9", "6", " ", " ",
    " ", " ", "1", "9", "5", " ", " ", " ", "2", "2", "9", " ", " ",
    " ", " ", "2", "7", "7", " ", " ", " ", " ", "3", "8", " ", " ",
    " ", " ", " ", "1", "6", ":", "4", "2", ":", "3", "9", "\n",
    "\n", "", "2", "9", "6", " ", " ", " ", " ", "1", "9", "5"
  )

  # execute
  tidy_ok <- tidy_iobed_stream(ok_stream)
  tidy_ko <- tidy_iobed_stream(ko_stream)

  # test
  expect_tibble(tidy_ok)
  expect_named(
    tidy_ok,
    c("sbl", "sbr", "sul", "sur","peso","time", "allarme attivo")
  )
  expect_equal(nrow(tidy_ok), 2)
  expect_equal(nrow(tidy_ko), 1)

})
